<app-bdm-navbar></app-bdm-navbar>

<div class="container">
  <div class="nav-bar">

    <div class="row justify-content-center">
      <div class="col-md-8 col-lg-6">


        <div style="margin-top: 70px; margin-left: 50%; "
          class="d-flex flex-column flex-md-row align-items-center justify-content-between">
          <button style="background-color: #4caf50; font-weight: bolder;" (click)="openModal(item)"
            class="btn btn-success btn-schedule">

            Register Client
          </button>
        </div>

      </div>
    </div>


    <form #itemForm="ngForm" (ngSubmit)="onSubmit(itemForm)">
      <div class="modal fade" id="updateModal" tabindex="-1" aria-labelledby="updateModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
          <div class="modal-content custom-modal">


            <div class="modal-header text-center" style="background-color: #4caf50; padding: 0.8rem;">
              <h5 class="modal-title w-100" id="updateModalLabel" style="color: white;">Enter Client Details</h5>
            </div>

            <div class="modal-body" style="padding: 0.7rem;">
              <div class="card mb-2 shadow-sm">
                <div class="card-body" style="padding: 0.5rem;">
                  <h6 class="card-title"
                    style="font-size: 20px; font-weight: bold;text-decoration: blueviolet solid 2px underline;text-align: center; color: blueviolet;">
                    Basic
                    Information</h6>
                  <div class="row">
                    <div class="col-md-4 mb-1">
                      <label for="companyName" class="form-label"
                        style="margin-bottom: 0.3rem; font-weight: bold;">Company Name</label>
                      <input type="text" class="form-control small-input " id="companyName"
                        [(ngModel)]="item.companyName" name="companyName" required minlength="3">
                    </div>
                    <div class="col-md-4 mb-1">
                      <label for="companyStrength" class="form-label"
                        style="margin-bottom: 0.3rem;   font-weight: bold;">Company
                        Strength</label>
                      <select class="form-select" style=" border-radius: 0px;" id="companyStrength"
                        [(ngModel)]="item.companyStrength" name="companyStrength" required>
                        <option *ngFor="let strength of companyStrengthLevels" [value]="strength">{{ strength }}
                        </option>
                      </select>
                    </div>
                    <div class="col-md-4 mb-1">
                      <label for="companyRole" class="form-label"
                        style="margin-bottom: 0.3rem;   font-weight: bold;">Job Role</label>
                      <select class="form-select small-select " style=" border-radius: 0px;" id="companyRole"
                        [(ngModel)]="selectedRole" name="companyRole" (change)="onRoleChange($event)" required>
                        <option *ngFor="let role of companyRoles" [value]="role">{{ role }}</option>
                        <option value="Other">Other</option>
                      </select>
                      <input *ngIf="selectedRole === 'Other'" type="text" class="form-control mt-1 small-select"
                        id="customRole" [(ngModel)]="item.companyRole" name="customRole" placeholder="Please Specify">
                    </div>
                  </div>
                  <div class="row">
                    <div class="col-md-4 mb-1">
                      <label for="companyLink" class="form-label"
                        style="margin-bottom: 0.3rem; font-weight: bold;">Company Link</label>
                      <input type="text" class="form-control small-input " id="companyLink"
                        [(ngModel)]="item.companyLink" name="companyLink" required pattern="https?://.+">
                    </div>
                    <div class="col-md-4 mb-1">
                      <label for="experience" class="form-label"
                        style="margin-bottom: 0.3rem;   font-weight: bold;">Experience</label>
                      <select class="form-select small-select " style=" border-radius: 0px;" id="experience"
                        [(ngModel)]="item.experience" name="experience" required>
                        <option *ngFor="let exp of experienceLevels" [value]="exp">{{ exp }}</option>
                      </select>
                    </div>
                    <div class="col-md-4 mb-1">
                      <label for="location" class="form-label"
                        style="margin-bottom: 0.3rem;   font-weight: bold;">Location</label>
                      <input type="text" class="form-control small-input " id="location" [(ngModel)]="item.location"
                        name="location" list="locationList" (input)="filterLocations()" required>
                      <datalist id="locationList">
                        <option *ngFor="let loc of filteredLocations" [value]="loc"></option>
                      </datalist>
                    </div>
                  </div>
                </div>
              </div>

              <div class="card mb-2 shadow-sm">
                <div class="card-body" style="padding: 0.6rem;">
                  <h6 class="card-title"
                    style="font-size: 20px; font-weight: bold; text-align: center;text-decoration: blueviolet solid 2px underline; color:  blueviolet;">
                    Additional
                    Details</h6>
                  <div class="row">
                    <div class="col-md-4 mb-1">
                      <label for="portalLink" class="form-label"
                        style="margin-bottom: 0.3rem;   font-weight: bold;">Reference Person</label>
                      <input type="url" class="form-control small-input " id="referencePerson"
                        [(ngModel)]="item.referencePerson" name="referencePerson" required>
                    </div>
                    <div class="col-md-4 mb-1">
                      <label for="companyEmail" class="form-label"
                        style="margin-bottom: 0.3rem;   font-weight: bold;">Reference Person Email</label>
                      <input type="email" class="form-control small-input " id="referencePersonEmail"
                        [(ngModel)]="item.referencePersonEmail" name="referencePersonEmail" required email>
                    </div>

                    <div class="col-md-4 mb-1">
                      <label for="contactNumber" class="form-label"
                        style="margin-bottom: 0.3rem;  font-weight: bold;">Contact
                        Number</label>
                      <div class="input-group">
                        <select class="form-select small-select country-code " style=" border-radius: 0px;"
                          id="countryCode" [(ngModel)]="item.countryCode" name="countryCode" required>
                          <option *ngFor="let code of countryCodes" [value]="code">{{ code }}</option>
                        </select>
                        <input type="text" class="form-control small-input contact-number" id="contactNumber"
                          [(ngModel)]="item.contactNumber" name="contactNumber" required pattern="[0-9]{10}"
                          maxlength="10">
                      </div>
                    </div>
                  </div>
                  <div class="mb-1">
                    <label for="jobDescription" class="form-label"
                      style="margin-bottom: 0.3rem;   font-weight: bold;">Job
                      Description</label>
                    <textarea class="form-control" id="jobDescription" [(ngModel)]="item.jobDescription"
                      name="jobDescription" rows="3" required></textarea>
                  </div>
                </div>
              </div>
            </div>


            <div class="modal-footer custom-footer d-flex justify-content-center"
              style="padding: 0.3rem; font-weight: bold;">
              <button class="btn btn-secondary" data-bs-dismiss="modal" style="margin-right: 1rem;">Close</button>
              <button class="btn btn-primary" type="submit" [disabled]="itemForm.invalid">Add Client</button>

            </div>
          </div>
        </div>
      </div>
    </form>

    <!-- Add Client Modal -->

    <div class="modal fade" id="AddClientModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-sm">
        <div class="modal-content text-center">
          <div class="modal-body p-4">
            <i class="bi bi-check-circle-fill text" style="font-size: 3rem; color: #4caf50;"></i>

            <p class="mt-3 mb-4" style="font-size: 1.2rem; font-weight: bold;">Client Registered Successfully!</p>
            <button type="button" class="btn btn-success" data-bs-dismiss="modal">OK</button>
          </div>
        </div>
      </div>
    </div>

    <BR>

    <div class="table-wrapper">
      <div class="table-responsive">


        <div class="search-container">
          <div class="search-left">
            <div class="input-group" style=" max-width: 170px;">
              <div class="input-group-prepend">
                <span class="input-group-text" id="search-addon1">
                  <i class="fas fa-search"></i>
                </span>
              </div>
              <input type="text" class="form-control" style="height: 35px; padding: 5px 10px; font-size: 16px; "
                placeholder="Company Name" [(ngModel)]="search.companyName" (ngModelChange)="filterItems()" />
            </div>
          </div>

          <div class="search-center">
            <div class="input-group" style="margin-left: -25%; max-width: 170px;">
              <div class="input-group-prepend">
                <span class="input-group-text" id="search-addon2">
                  <i class="fas fa-briefcase"></i>
                </span>
              </div>
              <input type="text" class="form-control" style="height: 35px; padding: 5px 10px; font-size: 16px; "
                placeholder="Job Role" [(ngModel)]="search.companyRole" (ngModelChange)="filterItems()" />
            </div>
          </div>

          <div class="search-right">
            <div class="input-group" style="margin-left: 30px; max-width: 170px;">
              <div class="input-group-prepend">
                <span class="input-group-text" id="search-addon3">
                  <i class="fas fa-map-marker-alt"></i>
                </span>
              </div>
              <input type="text" class="form-control" style="height: 35px; padding: 5px 10px; font-size: 16px; "
                placeholder="Location" [(ngModel)]="search.location" (ngModelChange)="filterItems()" />
            </div>
          </div>
        </div>




        <table class="table employee-table">
          <thead>
            <tr>
              <th
                style=" text-align: center; padding: 12px; background-color: #4caf50;color: white; border-radius: 10px 0 0 0;">
                Company Name</th>
              <th style="text-align: center;padding: 12px; background-color: #4caf50;color: white;">Strength</th>

              <th style=" text-align: center;padding: 12px; background-color: #4caf50;color: white;">Experience</th>
              <th style=" text-align: center;padding: 12px; background-color: #4caf50;color: white;">Job Role</th>
              <th style="text-align: center;padding: 12px; background-color: #4caf50;color: white;">Contact Number</th>
              <th style="text-align: center;padding: 12px; background-color: #4caf50;color: white;">Location</th>
              <th
                style="text-align: center;padding: 12px; background-color: #4caf50;color: white; border-radius: 0 10px 0 0;">
                Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let item of items | paginate: { itemsPerPage: itemsPerPage, currentPage: currentPage };let x of filteredItems; let i = index">

              <td style=" text-align: center;padding: 13px;" data-label="Company Name">{{ item.companyName }}</td>
              <td style=" text-align: center;padding: 13px;white-space: nowrap;border-left: 0.5px solid #4caf50; "
                data-label="Strength">{{
                item.companyStrength }}</td>
              <td style=" text-align: center;padding: 13px; white-space: nowrap; border-left: 0.5px solid #4caf50;"
                data-label="Experience">{{
                item.experience }}</td>
              <td style=" text-align: center;padding: 13px;white-space: nowrap; border-left: 0.5px solid #4caf50;"
                data-label="Job Role">{{
                item.companyRole }}</td>
              <td style=" text-align: center;padding: 13px;white-space: nowrap; border-left: 0.5px solid #4caf50;"
                data-label="Contact">{{
                item.contactNumber }}</td>
              <td style=" text-align: center;padding: 13px; white-space: nowrap; border-left: 0.5px solid #4caf50;"
                data-label="Location">{{ item.location
                }}</td>


              <td style=" text-align: center;padding: 13px; border-left: 0.5px solid #4caf50;" class="actions"
                data-label="Actions">
                <div class="btn-group">
                  <button class="btn btn-primary btn-sm" (click)="viewItem(item)" title="View More"
                    data-bs-toggle="modal" data-bs-target="#companyDetailsModal">
                    <i class="fas fa-eye"></i>
                  </button>


                  <div class="modal fade" id="companyDetailsModal" tabindex="-1" aria-labelledby="modalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-lg">
                      <div class="modal-content-3 shadow-lg">
                        <div class="modal-body bg-light">
                          <h2 class="text-center text mb-4" style="font-weight: bolder; color: #4caf50;">Company Details
                          </h2>

                          <div class="company-detail">
                            <p class="detail-item"><strong>Company Name: </strong> <span>{{ selectedCompany?.name
                                }}</span></p>
                            <p class="detail-item"><strong>Company Strength: </strong> <span>{{
                                selectedCompany?.strength }}</span></p>

                            <p class="detail-item"><strong>Company Link: </strong> <span><a
                                  [href]="selectedCompany?.link" target="_blank"
                                  class="text-success text-decoration-underline">{{ selectedCompany?.link }}</a></span>
                            </p>
                            <!-- <p class="detail-item"><strong>Reference Person: </strong> <span><a
                                  [href]="'mailto:' + selectedCompany?.referenceperson"
                                  class="text-success text-decoration-underline">{{ selectedCompany?.referenceperson
                                  }}</a></span></p> -->
                            <p class="detail-item"><strong>Reference Person: </strong> <span>{{
                                selectedCompany?.referenceperson
                                }}</span></p>

                            <p class="detail-item"><strong>Reference Person Email: </strong> <span><a
                                  [href]="'mailto:' + selectedCompany?.referencepersonemail"
                                  class="text-success text-decoration-underline">{{ selectedCompany?.referencepersonemail
                                  }}</a></span></p>
                            <p class="detail-item"><strong>Location: </strong> <span>{{ selectedCompany?.location
                                }}</span></p>
                            <p class="detail-item"><strong>Contact Number : </strong> <span>{{
                                selectedCompany?.contactno }}</span></p>
                            <p class="detail-item"><strong>Job Description: </strong> <span>{{
                                selectedCompany?.jobDescription }}</span></p>
                          </div>

                        </div>
                        <div class="modal-footer bg-light d-flex justify-content-center">
                          <button type="button" class="btn" style="background-color: #4caf50;color: white;"
                            data-bs-dismiss="modal">Close</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <button class="btn btn-warning btn-sm" (click)="openModal_2(item)" title="Edit">
                    <i class="fas fa-edit"></i>
                  </button>
                  <form #itemForm="ngForm">
                    <div class="modal fade" id="updateModal_2" tabindex="-1" aria-labelledby="updateModalLabel"
                      aria-hidden="true">
                      <div class="modal-dialog modal-lg">
                        <div class="modal-content custom-modal">
                          <div class="modal-header" style="background-color: #4caf50;padding: 0.8rem;">

                            <h5 class="modal-title w-100 text-center" id="updateModalLabel" style="color: white;">Update
                              Client Details</h5>
                          </div>



                          <div class="modal-body" style="padding: 8px;">

                            <div class="card mb-2 shadow-sm">
                              <div class="card-body" style="padding: 10px;">
                                <h6 class="card-title"
                                  style="font-size: 20px; font-weight: bold; text-align: center;text-decoration: blueviolet solid 2px underline; color:  blueviolet;">
                                  Basic Information</h6>
                                <div class="row">
                                  <div class="col-md-4">
                                    <div class="mb-1">
                                      <label for="companyName" class="form-label "
                                        style="text-align: left; font-weight: bold;">Company Name</label>
                                      <input type="text" class="form-control small-input" id="companyName"
                                        [(ngModel)]="selectedItem.companyName" name="companyName" required>
                                    </div>
                                  </div>
                                  <div class="col-md-4">
                                    <div class="mb-1">
                                      <label for="companyRole" class="form-label "
                                        style="text-align: left; font-weight: bold;">Job Role</label>
                                      <select class="form-select small-select" style=" border-radius: 0px"
                                        id="companyRole" [(ngModel)]="selectedItem.companyRole" name="companyRole"
                                        (change)="onRoleChange($event)" required>
                                        <option *ngFor="let role of companyRoles" [value]="role">{{ role }}</option>
                                        <option value="Other">Other</option>
                                      </select>
                                      <input *ngIf="selectedRole === 'Other'" type="text"
                                        class="form-control small-input mt-1" id="customRole"
                                        [(ngModel)]="selectedItem.companyRole" name="customRole"
                                        placeholder="Please specify">
                                    </div>
                                  </div>

                                  <div class="col-md-4">
                                    <div class="mb-1">
                                      <label for="companyStrength" class="form-label "
                                        style="text-align: left; font-weight: bold;">Company Strength</label>
                                      <select class="form-select small-select" style=" border-radius: 0px"
                                        id="companyStrength" [(ngModel)]="selectedItem.companyStrength"
                                        name="companyStrength" required>
                                        <option *ngFor="let strength of companyStrengthLevels" [value]="strength">{{
                                          strength }}</option>
                                      </select>
                                    </div>
                                  </div>
                                </div>

                                <div class="row">
                                  <div class="col-md-4">
                                    <div class="mb-1">
                                      <label for="companyLink" class="form-label"
                                        style="text-align: left; font-weight: bold;">Company Link</label>
                                      <input type="text" class="form-control small-input" id="companyLink"
                                        [(ngModel)]="selectedItem.companyLink" name="companyLink" required>
                                    </div>
                                  </div>

                                  <div class="col-md-4">
                                    <div class="mb-1">
                                      <label for="experience" class="form-label"
                                        style="text-align: left; font-weight: bold;">Experience</label>
                                      <select class="form-select small-select" style=" border-radius: 0px"
                                        id="experience" [(ngModel)]="selectedItem.experience" name="experience"
                                        required>
                                        <option *ngFor="let exp of experienceLevels" [value]="exp">{{ exp }}</option>
                                      </select>
                                    </div>
                                  </div>

                                  <div class="col-md-4">
                                    <div class="mb-1">
                                      <label for="location" class="form-label"
                                        style="text-align: left; font-weight: bold;">Location</label>
                                      <input type="text" class="form-control small-input" id="location"
                                        [(ngModel)]="selectedItem.location" name="location" list="locationList"
                                        (input)="filterLocations()" (change)="onLocationChange($event)" required>
                                      <datalist id="locationList">
                                        <option *ngFor="let loc of filteredLocations" [value]="loc"></option>
                                      </datalist>
                                    </div>
                                  </div>

                                </div>


                              </div>
                            </div>

                            <div class="card mb-2 shadow-sm">
                              <div class="card-body" style="padding: 10px;">
                                <h6 class="card-title"
                                  style="font-size: 20px; font-weight: bold; text-align: center;text-decoration: blueviolet solid 2px underline; color:  blueviolet;">
                                  Additional Details</h6>
                                <div class="row">
                                  <div class="col-md-4">
                                    <div class="mb-1">
                                      <label for="portalLink" class="form-label"
                                        style="text-align: left; font-weight: bold;">Reference Person</label>
                                      <input type="url" class="form-control small-input" id="referencePerson"
                                        [(ngModel)]="selectedItem.referencePerson" name="referencePerson" required>
                                    </div>
                                  </div>

                                  <div class="col-md-4">
                                    <div class="mb-1">
                                      <label for="companyEmail" class="form-label"
                                        style="text-align: left; font-weight: bold;">Reference Person Email</label>
                                      <input type="email" class="form-control small-input" id="referencePersonEmail"
                                        [(ngModel)]="selectedItem.referencePersonEmail" name="referencePersonEmail"
                                        required>
                                    </div>
                                  </div>

                                  <div class="col-md-4">
                                    <div class="mb-1">
                                      <label for="contactNumber" class="form-label"
                                        style="text-align: left; font-weight: bold;">Contact Number</label>
                                      <div class="input-group">
                                        <select class="form-select small-input country-code" style=" border-radius: 0px"
                                          id="countryCode" [(ngModel)]="selectedItem.countryCode" name="countryCode"
                                          required>
                                          <option *ngFor="let code of countryCodes" [value]="code">{{ code }}</option>
                                        </select>
                                        <input type="text" class="form-control small-input contact-number"
                                          id="contactNumber" [(ngModel)]="selectedItem.contactNumber"
                                          name="contactNumber" required maxlength="10">
                                      </div>
                                    </div>
                                  </div>
                                </div>

                                <div class="mb-1">
                                  <label for="jobDescription" class="form-label "
                                    style="text-align: left; font-weight: bold;">Job Description</label>
                                  <textarea class="form-control custom-input" id="jobDescription"
                                    [(ngModel)]="selectedItem.jobDescription" name="jobDescription" rows="3"
                                    required></textarea>
                                </div>
                              </div>
                            </div>
                          </div>


                          <div class="modal-footer" style="display: flex; justify-content: center; padding: 5px;">

                            <button class="btn btn-secondary btn-gradient" data-bs-dismiss="modal">Close</button>
                            <button type="submit" class="btn btn-primary btn-gradient" [disabled]="itemForm.invalid"
                              (click)="saveChanges(selectedItem.companyId)">Update Client</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </form>

                  <!-- Update Client Modal -->
                  <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered modal-sm">
                      <div class="modal-content text-center">
                        <div class="modal-body p-4">
                          <i class="bi bi-check-circle-fill text" style="font-size: 3rem; color: #4caf50;"></i>
                          <p class="mt-3" style="font-size: 1.2rem; font-weight: bold;">Registered Client Updated
                            Successfully!</p>

                        </div>
                        <div class="modal-footer d-flex justify-content-center">
                          <button type="button" class="btn btn-success" data-bs-dismiss="modal">OK</button>
                        </div>
                      </div>
                    </div>
                  </div>


                  <button class="btn btn-danger btn-sm" (click)="openDeleteModal(item)" title="Delete">
                    <i class="fas fa-trash"></i>
                  </button>


                  <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel"
                    aria-hidden="true">
                    <div class="modal-dialog modal-dialog-centered">
                      <div class="modal-content">
                        <div class="modal-header  text-white" style="background-color: #4caf50;">
                          <h5 class="modal-title w-100 text-center fw-bold" style="color: white" id="deleteModalLabel">
                            ⚠️ DELETE CONFIRMATION
                          </h5>
                        </div>
                        <div class="modal-body text-center">
                          <h5 style="color: black; font-weight: 400;">Are you sure you want to delete this Client?</h5>
                          <p class="text-warning fs-6 fw-bold">This action is irreversible!</p>
                          <br>

                          <div class=" justify-content-center">
                            <button type="button" class="btn btn-secondary  px-4"
                              data-bs-dismiss="modal">Cancel</button>
                            <button type="button" class="btn btn-danger  px-4" (click)="confirmDelete()">Delete</button>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <div *ngIf="showPagination">
        <pagination-controls (pageChange)="currentPage = $event"
          class="d-flex justify-content-center"></pagination-controls>

      </div>
    </div>
    <br>

  </div>

</div>